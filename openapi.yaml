openapi: 3.0.3
info:
  title: CarRaces API
  version: 1.0.0
  description: API para gestión de campeonatos, clubes, pruebas y usuarios según la documentación del proyecto.
servers:
  - url: /api
    description: API local base path
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    page:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number (1-based)
    pageSize:
      name: pageSize
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      description: Number of items per page
    q:
      name: q
      in: query
      schema:
        type: string
      description: Full text search across common fields
    sort:
      name: sort
      in: query
      schema:
        type: string
      description: Sort expression, e.g. `Alias:asc` or `FechaDesde:desc`
    filterClubId:
      name: clubId
      in: query
      schema:
        type: integer
      description: Filter by ClubId
    filterDisciplineId:
      name: disciplineId
      in: query
      schema:
        type: integer
      description: Filter by DisciplineId

  schemas:
    DrivingEnviroment:
      type: object
      properties:
        DrivingEnviromentId:
          type: integer
        Alias:
          type: string
        Descripcion:
          type: string
        default:
          type: boolean
      required: [Alias, Descripcion]
      example:
        DrivingEnviromentId: 1
        Alias: Real
        Descripcion: coches con vehículos reales
        default: true

    Speciality:
      type: object
      properties:
        SpecialityId:
          type: integer
        Alias:
          type: string
        Descripcion:
          type: string
        default:
          type: boolean
      required: [Alias, Descripcion]
      example:
        SpecialityId: 1
        Alias: Circuito
        Descripcion: Circuito cerrado
        default: true

    Format:
      type: object
      properties:
        FormatId:
          type: integer
        Descripcion:
          type: string
        default:
          type: boolean
      required: [Descripcion]
      example:
        FormatId: 1
        Descripcion: Velocidad
        default: true

    Surface:
      type: object
      properties:
        SurfaceId:
          type: integer
        Descripcion:
          type: string
        default:
          type: boolean
      required: [Descripcion]
      example:
        SurfaceId: 10
        Descripcion: Asfalto
        default: true

    Discipline:
      type: object
      properties:
        DisciplineId:
          type: integer
        Alias:
          type: string
        Descripcion:
          type: string
        SpecialityId:
          type: integer
        FormatId:
          type: integer
        SurfaceId:
          type: integer
        default:
          type: boolean
      required: [Alias, Descripcion, SpecialityId, FormatId, SurfaceId]
      example:
        DisciplineId: 1
        Alias: Asfalto
        Descripcion: 1.1 Asfalto
        SpecialityId: 1
        FormatId: 1
        SurfaceId: 1
        default: true

    Division:
      type: object
      properties:
        DivisionId:
          type: integer
        Descripcion:
          type: string
        DisciplineId:
          type: integer
        ClubId:
          type: integer
        default:
          type: boolean
      required: [Descripcion, DisciplineId]
      example:
        DivisionId: 1
        Descripcion: Formula 1
        DisciplineId: 1
        ClubId: 0
        default: true

    Group:
      type: object
      properties:
        GroupId:
          type: integer
        Descripcion:
          type: string
        DivisionId:
          type: integer
        ClubId:
          type: integer
        default:
          type: boolean
      required: [Descripcion, DivisionId]

    Level:
      type: object
      properties:
        LevelId:
          type: integer
        Descripcion:
          type: string
      required: [Descripcion]

    ScoringDet:
      type: object
      properties:
        ScoringDetId:
          type: integer
        ScoringId:
          type: integer
        Posicion:
          type: integer
        Puntos:
          type: number
      required: [Posicion, Puntos]

    Scoring:
      type: object
      properties:
        ScoringId:
          type: integer
        Descripcion:
          type: string
        ClubId:
          type: integer
        UltPosPuntos:
          type: integer
        PuntosDefecto:
          type: number
        Details:
          type: array
          items:
            $ref: '#/components/schemas/ScoringDet'
      required: [Descripcion]
      example:
        ScoringId: 1
        Descripcion: Scoring default nacional
        ClubId: 0
        UltPosPuntos: 10
        PuntosDefecto: 25.0
        Details:
          - Posicion: 1
            Puntos: 25
          - Posicion: 2
            Puntos: 18

    Championship:
      type: object
      properties:
        ChampionshipId:
          type: integer
        Descripcion:
          type: string
        DrivingEnviromentId:
          type: integer
        SpecialityId:
          type: integer
        DisciplineId:
          type: integer
        DivisionId:
          type: integer
        GroupId:
          type: integer
        LevelId:
          type: integer
        ClubId:
          type: integer
        ScoringId:
          type: integer
      required: [Descripcion, DrivingEnviromentId, SpecialityId, DisciplineId, DivisionId, LevelId, ScoringId]

    Rulebook:
      type: object
      properties:
        RulebookId:
          type: integer
        Descripcion:
          type: string
        FechaInicioValido:
          type: string
          format: date
        FechaFinValido:
          type: string
          format: date
        DivisionId:
          type: integer
        GroupId:
          type: integer
        ClubId:
          type: integer
      required: [Descripcion, FechaInicioValido, DivisionId]

    Rule:
      type: object
      properties:
        RuleId:
          type: integer
        RulebookId:
          type: integer
        RuleCode:
          type: string
        Descripcion:
          type: string
      required: [RulebookId, RuleCode, Descripcion]

    Season:
      type: object
      properties:
        SeasonId:
          type: integer
        ChampionshipId:
          type: integer
        Descripcion:
          type: string
        FechaDesde:
          type: string
          format: date
        FechaHasta:
          type: string
          format: date
        PilotosMin:
          type: integer
        PilotosMax:
          type: integer
        SoloSocios:
          type: boolean
        RulebookId:
          type: integer
      required: [ChampionshipId, Descripcion, FechaDesde, FechaHasta, PilotosMin, PilotosMax]

    Club:
      type: object
      properties:
        ClubId:
          type: integer
        Alias:
          type: string
        TaxNombre:
          type: string
        TaxNumero:
          type: string
        Descripcion:
          type: string
        FechaFundacion:
          type: string
          format: date
        FechaRegistro:
          type: string
          format: date
      required: [Alias, TaxNombre, TaxNumero, Descripcion, FechaFundacion]
      example:
        ClubId: 1
        Alias: ClubRacing
        TaxNombre: Racing SL
        TaxNumero: B12345678
        Descripcion: Club de pruebas
        FechaFundacion: '1995-06-15'

    Venue:
      type: object
      properties:
        VenueId:
          type: integer
        ClubId:
          type: integer
        Alias:
          type: string
        SedeSocial:
          type: boolean
        SedeCarreras:
          type: boolean
        Direccion:
          type: string
        Localidad:
          type: string
        Provincia:
          type: string
        Pais:
          type: string
        MapLatitud:
          type: number
        MapLongitud:
          type: number
      required: [ClubId, Alias, SedeSocial, SedeCarreras]

    Circuit:
      type: object
      properties:
        CircuitId:
          type: integer
        VenueId:
          type: integer
        SurfaceId:
          type: integer
        DrivingEnviromentId:
          type: integer
        Alias:
          type: string
        Descripcion:
          type: string
        Longitud:
          type: number
        Permanente:
          type: boolean
        TotSegments:
          type: integer
        SlotAnalogic:
          type: boolean
        SlotDigital:
          type: boolean
        SlotTotLanes:
          type: integer
      required: [VenueId, SurfaceId, DrivingEnviromentId, Alias, Permanente, TotSegments]

    Segment:
      type: object
      properties:
        SegmentId:
          type: integer
        CircuitId:
          type: integer
        Alias:
          type: string
        NumSegment:
          type: integer
        NumLane:
          type: integer
        TotSections:
          type: integer
        Longitud:
          type: number
      required: [CircuitId, Alias]

    Event:
      type: object
      properties:
        EventId:
          type: integer
        Descripcion:
          type: string
        FechaInicio:
          type: string
          format: date
        FechaFin:
          type: string
          format: date
        ClubId:
          type: integer
      required: [Descripcion, FechaInicio, FechaFin, ClubId]

    Competition:
      type: object
      properties:
        CompetitionId:
          type: integer
        SeasonId:
          type: integer
        EventId:
          type: integer
        VenueId:
          type: integer
        Alias:
          type: string
        TotalRaces:
          type: integer
        FechaInicioInscripPri:
          type: string
          format: date
        FechaFinInscripPri:
          type: string
          format: date
        FechaInicioInscrip:
          type: string
          format: date
        FechaFinInscrip:
          type: string
          format: date
        PilotosMinInscrip:
          type: integer
        PilotosMaxInscrip:
          type: integer
        Responsable:
          type: integer
        SoloUsuariosReg:
          type: boolean
        Notas:
          type: string
      required: [SeasonId, EventId, VenueId, Alias, TotalRaces, Responsable, SoloUsuariosReg]
      example:
        CompetitionId: 100
        SeasonId: 10
        EventId: 5
        VenueId: 2
        Alias: Copa Primavera
        TotalRaces: 3
        Responsable: 7
        SoloUsuariosReg: false

    Registration:
      type: object
      properties:
        RegistrationId:
          type: integer
        CompetitionId:
          type: integer
        UserId:
          type: integer
        FechaPreRegistro:
          type: string
          format: date
        FechaRegistro:
          type: string
          format: date
        Dorsal:
          type: integer
      required: [CompetitionId, UserId]

    Race:
      type: object
      properties:
        RaceId:
          type: integer
        CompetitionId:
          type: integer
        NumRace:
          type: integer
        Fecha:
          type: string
          format: date
        Hora:
          type: string
          format: date-time
        Estado:
          type: integer
      required: [CompetitionId, NumRace, Fecha, Hora, Estado]

    RaceResult:
      type: object
      properties:
        RaceResultId:
          type: integer
        RaceId:
          type: integer
        Posicion:
          type: integer
        UserId:
          type: integer
        Laps:
          type: integer
        NumSegment:
          type: integer
        Pole:
          type: boolean
        FastLap:
          type: boolean
      required: [RaceId, Posicion, UserId]

    EntityLink:
      type: object
      properties:
        EntityLinkId:
          type: integer
        EntityName:
          type: string
      required: [EntityName]

    Rol:
      type: object
      properties:
        RolId:
          type: integer
        Nombre:
          type: string
        Pseudonimo:
          type: string
      required: [Nombre, Pseudonimo]

    RolEntity:
      type: object
      properties:
        RolEntityId:
          type: integer
        EntityLinkId:
          type: integer
        RolId:
          type: integer
      required: [EntityLinkId, RolId]

    User:
      type: object
      properties:
        UserId:
          type: integer
        Nick:
          type: string
        Nombre:
          type: string
        Apellidos:
          type: string
        Direccion:
          type: string
        Localidad:
          type: string
        Provincia:
          type: string
        Pais:
          type: string
        Telefono:
          type: string
        Email:
          type: string
        FechaRegistro:
          type: string
          format: date
      required: [Nick, Nombre]
      example:
        UserId: 7
        Nick: piloto7
        Nombre: Juan
        Apellidos: Pérez
        Email: juan.perez@example.com

    UserEntity:
      type: object
      properties:
        UserEntityId:
          type: integer
        UserId:
          type: integer
        EntityLinkId:
          type: integer
        RolId:
          type: integer
        EntityId:
          type: integer
        FechaRegistro:
          type: string
          format: date
        Activo:
          type: boolean
      required: [UserId, EntityLinkId, RolId, EntityId]

  responses:
    NotFound:
      description: Entity not found
    BadRequest:
      description: Invalid request

paths:
  /drivingenviroments:
    get:
      tags: [DrivingEnviroment]
      summary: List DrivingEnviroments (paginated, filterable)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - $ref: '#/components/parameters/q'
        - name: alias
          in: query
          schema:
            type: string
          description: Filter by Alias (exact or partial)
        - name: default
          in: query
          schema:
            type: boolean
          description: Filter by default flag
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/DrivingEnviroment'
              examples:
                sample:
                  summary: Sample paged response
                  value:
                    total: 5
                    page: 1
                    pageSize: 20
                    items:
                      - DrivingEnviromentId: 1
                        Alias: Real
                        Descripcion: coches con vehículos reales
                        default: true
        '400':
          $ref: '#/components/responses/BadRequest'
    post:
      tags: [DrivingEnviroment]
      summary: Create DrivingEnviroment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DrivingEnviroment'
            examples:
              create:
                summary: Create example
                value:
                  Alias: Virtual
                  Descripcion: SimRancing
                  default: false
      responses:
        '201':
          description: Created

  /specialities:
    get:
      tags: [Speciality]
      summary: List Specialities (paginated)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - $ref: '#/components/parameters/q'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Speciality'

  /disciplines:
    get:
      tags: [Discipline]
      summary: List Disciplines (filter by speciality/format/surface)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - name: specialityId
          in: query
          schema:
            type: integer
        - name: formatId
          in: query
          schema:
            type: integer
        - name: surfaceId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Discipline'

  /divisions:
    get:
      tags: [Division]
      summary: List Divisions (filter by discipline)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - $ref: '#/components/parameters/filterDisciplineId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Division'

  /championships:
    get:
      tags: [Championship]
      summary: List Championships (filter by level/club)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - $ref: '#/components/parameters/filterClubId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Championship'

  /clubs:
    get:
      tags: [Club]
      summary: List Clubs (searchable)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - $ref: '#/components/parameters/q'
        - name: alias
          in: query
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Club'
    post:
      tags: [Club]
      summary: Create Club
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Club'
            examples:
              createClub:
                summary: Create Club example
                value:
                  Alias: ClubRacing
                  TaxNombre: Racing SL
                  TaxNumero: B12345678
                  Descripcion: Club de pruebas
                  FechaFundacion: '1995-06-15'
      responses:
        '201':
          description: Created

  /users:
    get:
      tags: [User]
      summary: List Users (search, pagination)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - $ref: '#/components/parameters/q'
        - name: nick
          in: query
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
    post:
      tags: [User]
      summary: Create User
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
            examples:
              createUser:
                summary: Create user example
                value:
                  Nick: piloto7
                  Nombre: Juan
                  Apellidos: Pérez
                  Email: juan.perez@example.com
      responses:
        '201':
          description: Created

  /competitions:
    get:
      tags: [Competition]
      summary: List Competitions (filter by season/event/venue)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - name: seasonId
          in: query
          schema:
            type: integer
        - name: eventId
          in: query
          schema:
            type: integer
        - name: venueId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Competition'

  /events:
    get:
      tags: [Event]
      summary: List Events (filter by club/date)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - name: clubId
          in: query
          schema:
            type: integer
        - name: from
          in: query
          schema:
            type: string
            format: date
          description: Start date filter
        - name: to
          in: query
          schema:
            type: string
            format: date
          description: End date filter
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Event'

  /registrations:
    get:
      tags: [Registration]
      summary: List Registrations (filter by competition/user)
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
        - name: competitionId
          in: query
          schema:
            type: integer
        - name: userId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Registration'

  /races/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    put:
      tags: [Race]
      summary: Update Race (used to set date/time/state)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Race'
            examples:
              updateRace:
                summary: Set race schedule and state
                value:
                  CompetitionId: 100
                  NumRace: 1
                  Fecha: '2026-05-10'
                  Hora: '2026-05-10T10:30:00Z'
                  Estado: 1
      responses:
        '200':
          description: Updated

  /raceresults/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    put:
      tags: [RaceResult]
      summary: Update RaceResult (submit results for a race)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RaceResult'
            examples:
              results:
                summary: Race results example
                value:
                  RaceId: 200
                  Posicion: 1
                  UserId: 7
                  Laps: 12
                  Pole: false
                  FastLap: true
      responses:
        '200':
          description: Updated

  /entitylinks:
    get:
      tags: [EntityLink]
      summary: List EntityLinks
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EntityLink'

  /roles:
    get:
      tags: [Rol]
      summary: List Roles
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Rol'

  /rolentities:
    get:
      tags: [RolEntity]
      summary: List RolEntities
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RolEntity'
    post:
      tags: [RolEntity]
      summary: Create RolEntity
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RolEntity'
      responses:
        '201':
          description: Created

  /userentities:
    get:
      tags: [UserEntity]
      summary: List UserEntities
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserEntity'
    post:
      tags: [UserEntity]
      summary: Create UserEntity (associate user with entity/role)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserEntity'
            examples:
              associate:
                summary: Associate user to competition as responsible
                value:
                  UserId: 7
                  EntityLinkId: 3
                  RolId: 7
                  EntityId: 100
      responses:
        '201':
          description: Created

security:
  - bearerAuth: []
